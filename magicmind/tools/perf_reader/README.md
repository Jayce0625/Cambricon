# MagicMind Perf Reader Tool

## 性能数据解析

如果需要打印模型执行时各个Kernel-Layer的Top-K耗时，可以使用当前脚本解析magicmind::IProfiler所给出的序列化性能数据。

## 安装依赖

```bash
pip3 install -r requirements.txt
```

## 解析性能数据
以MagicMind多卡多线程离线模型性能测试工具为例，执行命令行
```bash
path/to/mm_run --magicmind_model path/to/model --perf_path path/to/save_perf
```
执行上述命令若干次后，path/to/save_perf下会产生plugins文件夹，其中保存了若干执行的序列化性能数据，执行命令行
```bash
python3 read_tensorboard.py --proto_path [path/to/save_perf]/plugins/profile/[exec_time]/[...].kernel_stats.pb [--top K(default:10)]
```
以打印单个执行数据，
或使用命令行
```bash
python3 read_tensorboard.py --perf_path [path/to/save_perf] [--top K(default:10)]
```
以打印路径下全部执行数据，打印格式如下：

```bash
+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                                                                                 filepath1                                                                                    |
+------+----------------------------------------------------+------------------+------------+----------------------------------------------------------------------------------+
| rank |                    kernel_name                     | avg_duration(us) | percentage |                                    layer_name                                    |
+------+----------------------------------------------------+------------------+------------+----------------------------------------------------------------------------------+
|  1   |                        name1                       |      967.15      |   75.55%   |                                    layer_name1                                   |
+------+----------------------------------------------------+------------------+------------+----------------------------------------------------------------------------------+
```
